# name: CI

# on: [push, pull_request]

# jobs:
#     build_and_test:
#         runs-on: ubuntu-latest

#         steps:
#             - name: Check out repository code
#               uses: actions/checkout@v2

#             - name: Set up Docker Buildx
#               uses: docker/setup-buildx-action@v1

#             - name: Cache Docker layers
#               uses: actions/cache@v2
#               with:
#                   path: /tmp/.buildx-cache
#                   key: ${{ runner.os }}-buildx-${{ github.sha }}
#                   restore-keys: |
#                       ${{ runner.os }}-buildx-

#             - name: Build and push Docker images for frontend
#               uses: docker/build-push-action@v2
#               with:
#                   context: ./frontend
#                   file: ./frontend/Dockerfile
#                   push: false
#                   load: true
#                   cache-from: type=local,src=/tmp/.buildx-cache
#                   cache-to: type=local,dest=/tmp/.buildx-cache

#             - name: Build and push Docker images for backend
#               uses: docker/build-push-action@v2
#               with:
#                   context: ./backend
#                   file: ./backend/Dockerfile
#                   push: false
#                   load: true
#                   cache-from: type=local,src=/tmp/.buildx-cache
#                   cache-to: type=local,dest=/tmp/.buildx-cache

#             - name: Set up Docker Compose
#               run: |
#                   sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
#                   sudo chmod +x /usr/local/bin/docker-compose
#                   docker-compose --version

#             - name: Start containers
#               run: docker-compose up -d

#             - name: Install dependencies
#               run: npm install

#             - name: Run tests
#               run: npm run test
name: CI

on: [push, pull_request]

jobs:
    build_and_test:
        runs-on: ubuntu-latest

        steps:
            - name: Check out repository code
              uses: actions/checkout@v2

            - name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v1

            - name: Cache Docker layers
              uses: actions/cache@v2
              with:
                  path: /tmp/.buildx-cache
                  key: ${{ runner.os }}-buildx-${{ github.sha }}
                  restore-keys: |
                      ${{ runner.os }}-buildx-

            - name: Set up Docker Compose
              run: |
                  sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
                  sudo chmod +x /usr/local/bin/docker-compose
                  docker-compose --version

            - name: Build and start services with Docker Compose
              run: docker-compose up -d

            - name: Install dependencies
              run: npm install
              working-directory: frontend
            
            - name: Run tests
              run: npx playwright test
              working-directory: frontend
            
            
