# name: CI

# on: [push, pull_request]

# jobs:
#     build_and_test:
#         runs-on: ubuntu-latest

#         steps:
#             - name: Check out repository code
#               uses: actions/checkout@v2

#             - name: Set up Docker Buildx
#               uses: docker/setup-buildx-action@v1

#             - name: Cache Docker layers
#               uses: actions/cache@v2
#               with:
#                   path: /tmp/.buildx-cache
#                   key: ${{ runner.os }}-buildx-${{ github.sha }}
#                   restore-keys: |
#                       ${{ runner.os }}-buildx-

#             - name: Set up Docker Compose
#               run: |
#                   sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
#                   sudo chmod +x /usr/local/bin/docker-compose
#                   docker-compose --version

#             - name: Build and start services with Docker Compose
#               run: docker-compose up -d

#             - name: Install dependencies
#               run: npm install
#               working-directory: frontend

#             - name: Run tests
#               run: npx playwright test
#               working-directory: frontend

name: CI

on: [push]

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v2

            - name: Build the stack
              run: docker-compose -f docker-compose.yml up -d

            - name: Install dependencies and browsers
              run: |
                  docker exec -t web-engineering-3_frontend_1 npm install
                  docker exec -t web-engineering-3_frontend_1 npx playwright install-deps

            - name: Run tests
              run: docker exec -t web-engineering-3_frontend_1 npx playwright test --headed > test-output.txt

            - name: Upload test output artifact
              uses: actions/upload-artifact@v2
              with:
                  name: test-output
                  path: test-output.txt
